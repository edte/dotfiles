# Python安全规范精简版

## 通用类

### 加密算法
- **【必须】** 禁用DES/3DES，使用AES

### 程序日志
- **【建议】** 重要行为记录日志，保存6个月以上
- **【建议】** 禁止未验证的用户输入直接记录日志
- **【建议】** 日志中禁止保存密码、密钥等敏感信息

### 系统口令
- **【必须】** 禁用空口令、弱口令、已泄露口令
- **【必须】** 口令要求：长度>14位，含大小写字母+数字+特殊字符，不重复使用
- **【必须】** 使用不可逆算法+随机salt加密存储，禁止明文或弱加密
- **【必须】** 禁止传递明文口令或在不安全信道传输

### 配置&环境
- **【建议】** 使用Python 3.x security状态版本，避免EOL版本
- **【必须】** 禁用不安全组件
- **【必须】** 密钥安全存储，使用非对称算法协商
- **【必须】** 禁止硬编码AK/SK、IP、数据库账密，使用配置系统或KMS


## 后台类

### 输入验证
- **【必须】** 外部输入参数必须校验：数据长度、范围、类型、格式，推荐使用Cerberus/jsonschema/Django-Validators

### SQL操作
- **【必须】** 使用参数化查询，禁止字符串拼接SQL，推荐使用SQLAlchemy等ORM框架
- **【必须】** 动态拼接SQL时必须过滤特殊字符：`" \ / * ' = - # ; < > + & $ ( ) % @ ,`

### 执行命令
- **【建议】** 避免调用os.system()/os.popen()/subprocess.call()，优先使用文件系统API
- **【必须】** 必须过滤命令注入字符：`\n & ; | ' " $ ( ) ` -`，使用shlex.quote()
- **【必须】** 禁止eval()处理外部输入

### 文件操作
- **【必须】** 白名单校验文件类型和大小，禁止上传可执行文件
- **【必须】** 外部文件禁止存储于WEB可执行目录，使用tempfile库
- **【必须】** 路径校验防穿越：使用os.path.normpath()并检查startswith()
- **【必须】** XML解析禁用外部实体：`etree.XMLParser(resolve_entities=False)`
- **【必须】** 禁用yaml.unsafe_load()
- **【建议】** 文件名使用uuid.uuid4().hex随机化




### 网络请求
- **【必须】** 限定URL地址范围：仅允许HTTP/HTTPS，解析host获取IP，检查是否内网IP，防止SSRF

### 响应输出
- **【必须】** HTTP头Content-Type必须正确配置，禁止非HTML设为text/html
- **【必须】** 设置安全响应头：
  - X-Content-Type-Options: nosniff
  - Cookie设置HttpOnly防XSS
  - X-Frame-Options: DENY/SAMEORIGIN/ALLOW-FROM防点击劫持
- **【必须】** HTML响应必须对第三方数据编码，推荐使用bleach.clean()

### 数据输出
- **【必须】** 敏感数据使用SHA2/RSA加密存储，独立存储层+访问控制，临时文件及时删除
- **【必须】** 敏感信息后台脱敏，禁止前端脱敏
- **【必须】** 口令、密保答案、生理标识禁止展示；信用卡CVV码禁止存储
- **【必须】** 个人信息脱敏：身份证显示首尾位，手机号隐藏中间6位，地址最多到区，银行卡仅显示后4位
- **【必须】** 后台登录地址使用随机字符串隐藏

### 权限管理
- **【必须】** 默认鉴权，使用白名单放开公开接口
- **【必须】** 最小权限原则，默认用户无操作权限
- **【必须】** 防越权：验证登录态→从session获取身份→校验操作权限→校验数据权限→校验账户一致性
- **【建议】** 定期清理非必需用户权限

### 异常处理
- **【必须】** 使用try/except/finally处理异常，禁止错误信息输出前端
- **【必须】** 生产环境禁止开启debug模式或输出运行日志到前端
- **【必须】** 异常禁止抛出敏感信息

### Flask安全
- **【必须】** 生产环境关闭调试模式
- **【建议】** 遵循Flask安全规范：https://flask.palletsprojects.com/en/2.2.x/security/

### Django安全
- **【必须】** 生产环境关闭调试模式
- **【建议】** 保持Django自带安全特性开启（XSS/CSRF/SQL注入/点击劫持防护）：https://docs.djangoproject.com/en/3.0/topics/security/

