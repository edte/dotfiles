功能概述  
xlsx 技能为 Claude 提供了一套端到端的 Excel 文件处理能力，覆盖新建、读取、修改、分析与可视化全生命周期。它解决的核心问题是：在保持公式动态性与模板风格一致性的前提下，快速生成零错误、可交互、可审计的财务或数据模型。典型场景包括：为投资人输出多情景估值模型、为运营团队搭建可刷新的销售仪表盘、为审计师复算并标注外部链接来源，或在数据清洗后将结果写回带有格式与公式的模板。

使用方法

1. 选型：数据量较大或仅需统计时优先用 pandas；需要保留/写入公式、颜色、批注、跨表链接时用 openpyxl。
2. 环境：首次使用前确保系统已安装 LibreOffice，用于事后重算公式。recalc.py 会在首次调用时自动配置宏。
3. 新建文件  
   a. 实例化 Workbook，按财务色标规范写入假设（蓝字）、公式（黑字）、跨表链接（绿字）、外部链接（红字）。  
   b. 所有计算必须写成 Excel 公式串，例如 sheet[‘C5’] = ‘=C4\*(1+$B$1)’，禁止在 Python 内硬编码结果。  
   c. 对关键假设单元格添加黄色底纹，并在相邻单元格按“Source: 文档, 日期, 页码, URL”格式标注来源。
4. 编辑现有文件  
   a. load_workbook 时默认 data_only=False，确保公式不被覆盖；若仅读取数值可临时设为 True，但禁止回写。  
   b. 修改前先用 pandas 或 openpyxl 扫描原模板的颜色与数字格式，严格复刻；若模板已存在非标准格式，以模板为准。  
   c. 插入行列后，立即检查公式偏移，防止 #REF!。
5. 重算与质检  
   a. 保存后立即运行 python recalc.py output.xlsx [超时秒]，脚本返回 JSON：status、total_errors、error_summary。  
   b. 若 status=errors_found，按 locations 定位 #DIV/0!、#VALUE! 等，回代码修正后再重算，直至 total_errors=0。
6. 常见参数  
   recalc.py 超时默认 30 s；大模型可增至 120 s。  
   pandas 读取用 dtype 与 parse_dates 指定类型；openpyxl 设置列宽、字体、PatternFill 时颜色请用 RGB 元组。

预期输出  
成功流程将生成一个 .xlsx（或 .xlsm）文件，内含：

- 全部公式已重算且无误，任何单元格均不出现 #REF! 等错误。
- 数字格式符合财务规范：年份为文本、货币带千分位并于表头注明单位、零值显示为“-”、百分比保留一位小数、负数加括号。
- 颜色与注释完整：蓝字输入、黑字公式、绿字内链、红字外链、黄底关键假设，右侧或批注中附带可审计的来源字符串。
- 结构保留：若基于模板，原工作表顺序、隐藏列、打印区域、命名范围均保持不动。
- 附带 JSON 质检报告，可供下游系统解析，确认公式总数、错误数及具体坐标，实现自动化 CI 拦截。  
  后续可直接分发给业务用户进行情景填入，也可再由 Claude 读取数值做进一步分析或可视化，无需重新清洗。

